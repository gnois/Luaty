var strsub = string.sub

var new_string_reader = \src ->
	var pos = 1
	var reader = ->
		var chunk = strsub(src, pos, pos + 4096 - 32)
		pos = pos + #chunk
		return #chunk > 0 and chunk or nil
	return reader

var new_file_reader = \filename ->
	var f
	if filename
		f = assert(io.open(filename, 'r'), "cannot open file " .. filename)
	else
		f = io.stdin
	
	var reader = ->
		return f.read(@, 4096 - 32)
	return reader

return { 
	string = new_string_reader
	, file = new_file_reader
}
